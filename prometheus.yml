# Prometheus configuration for EpisodicMemory observability


global:
  scrape_interval: 15s         # Scrape targets every 15 seconds
  evaluation_interval: 15s     # Evaluate rules every 15 seconds
  scrape_timeout: 10s         # Timeout after 10 seconds

  external_labels:
    cluster: 'episodic-memory-dev'
    environment: 'development'

# Scrape configuration
scrape_configs:
  # EpisodicMemory service
  - job_name: 'episodic-memory'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'

    static_configs:
      - targets:
          - 'localhost:8000'  # Development (local FastAPI)
          # - 'episodic-memory:8000'  # Docker Compose
          # - 'episodic-memory-svc.default.svc.cluster.local:8000'  # Kubernetes

        labels:
          service: 'episodic-memory'
          version: '0.1.0'

    # Relabeling for cleaner instance names
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'episodic-memory-api'

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets:
          - 'localhost:9090'

# Alerting configuration (Phase 2 Week 7)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#             - 'localhost:9093'

# Alert rules (Phase 2 Week 7)
# rule_files:
#   - 'alerts.yml'

# Storage configuration
storage:
  tsdb:
    # Retention period (default: 15 days)
    # Production: Set to 90 days for long-term analysis
    retention.time: 90d

# Remote write configuration (optional - for long-term storage)
# remote_write:
#   - url: "https://prometheus-remote-storage.example.com/api/v1/write"
#     basic_auth:
#       username: episodic-memory
#       password_file: /etc/prometheus/remote_write_password
