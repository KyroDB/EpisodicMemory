# ConfigMap for EpisodicMemory configuration
# Phase 2 Week 7 - Non-sensitive configuration

apiVersion: v1
kind: ConfigMap
metadata:
  name: episodic-memory-config
  namespace: default
  labels:
    app: episodic-memory
data:
  # Service configuration
  SERVICE_HOST: "0.0.0.0"
  SERVICE_PORT: "8000"
  SERVICE_WORKERS: "4"

  # Logging configuration
  LOGGING_LEVEL: "INFO"
  LOGGING_JSON_OUTPUT: "true"
  LOGGING_COLORIZED: "false"
  LOGGING_SLOW_REQUEST_WARNING_MS: "100.0"
  LOGGING_SLOW_REQUEST_ERROR_MS: "500.0"
  LOGGING_SERVICE_NAME: "episodic-memory"
  LOGGING_SERVICE_VERSION: "0.1.0"
  LOGGING_ENVIRONMENT: "production"

  # KyroDB configuration (addresses only, TLS certs in secrets)
  KYRODB_TEXT_HOST: "kyrodb-text-svc.default.svc.cluster.local"
  KYRODB_TEXT_PORT: "50051"
  KYRODB_IMAGE_HOST: "kyrodb-image-svc.default.svc.cluster.local"
  KYRODB_IMAGE_PORT: "50052"
  KYRODB_ENABLE_TLS: "true"
  KYRODB_TLS_VERIFY_SERVER: "true"
  KYRODB_MAX_WORKERS: "10"
  KYRODB_CONNECTION_TIMEOUT_SECONDS: "30"
  KYRODB_REQUEST_TIMEOUT_SECONDS: "60"

  # Embedding configuration
  EMBEDDING_TEXT_MODEL_NAME: "all-MiniLM-L6-v2"
  EMBEDDING_TEXT_DIMENSION: "384"
  EMBEDDING_TEXT_BATCH_SIZE: "32"
  EMBEDDING_IMAGE_MODEL_NAME: "openai/clip-vit-base-patch32"
  EMBEDDING_IMAGE_DIMENSION: "512"
  EMBEDDING_IMAGE_BATCH_SIZE: "16"
  EMBEDDING_DEVICE: "cuda"  # Use GPU if available

  # Search configuration
  SEARCH_DEFAULT_K: "20"
  SEARCH_MAX_K: "100"
  SEARCH_PRECONDITION_THRESHOLD: "0.5"
  SEARCH_SIMILARITY_THRESHOLD: "0.6"
  SEARCH_FETCH_MULTIPLIER: "5"

  # CORS configuration (production)
  CORS_ALLOWED_ORIGINS: "https://app.example.com,https://api.example.com"
  CORS_ALLOW_CREDENTIALS: "true"
  CORS_ALLOWED_METHODS: "GET,POST,PUT,DELETE,PATCH,OPTIONS"
  CORS_ALLOWED_HEADERS: "*"
  CORS_MAX_AGE: "600"

  # Storage paths (mounted volumes)
  SERVICE_SCREENSHOT_STORAGE_PATH: "/app/data/screenshots"
  SERVICE_ARCHIVE_STORAGE_PATH: "/app/data/archive"

---
# Secret for sensitive configuration
# NOTE: In production, use sealed secrets or external secret management (Vault, AWS Secrets Manager)
apiVersion: v1
kind: Secret
metadata:
  name: episodic-memory-secrets
  namespace: default
  labels:
    app: episodic-memory
type: Opaque
stringData:
  # LLM API key for reflection generation
  LLM_API_KEY: "sk-your-openai-api-key-here"  # Replace with actual key
  LLM_MODEL_NAME: "gpt-4"

  # TLS certificates for KyroDB (base64 encode in production)
  # KYRODB_TLS_CA_CERT_PATH: /app/certs/ca.crt
  # KYRODB_TLS_CLIENT_CERT_PATH: /app/certs/client.crt
  # KYRODB_TLS_CLIENT_KEY_PATH: /app/certs/client.key

  # Customer database encryption key (Phase 4)
  # DATABASE_ENCRYPTION_KEY: "your-encryption-key-here"

  # Webhook signing secret (Phase 4)
  # WEBHOOK_SIGNING_SECRET: "your-webhook-secret-here"

  # Stripe API key (Phase 4)
  # STRIPE_API_KEY: "sk_live_your_stripe_key_here"
  # STRIPE_WEBHOOK_SECRET: "whsec_your_webhook_secret_here"
